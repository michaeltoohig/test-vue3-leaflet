import{_ as O,a as z,l as W,w as D,b as g,d as V,c as H,e as L,f as P}from"./lodash-12e9fd16.js";import{d as B,r as c,i as x,o as C,a as A,b as a,c as _,e as m,w as f,u as o,f as M,t as q,g as v,h as T,j as h,F as E,k as j,_ as Z}from"./index-4329d3ed.js";const K={class:"text-blue-600 font-semibold"},R=B({__name:"TestPopup",props:{land:{type:Object,required:!0}},setup(d){const y=d,l=c(!1),n=x("layer");return C(()=>{n.on("click",()=>console.log("test",y.land.id)),n.on("mouseover",()=>l.value=!0),n.on("mouseout",()=>l.value=!1)}),A(()=>{n.off("mouseover"),n.off("mouseout")}),(p,u)=>(a(),_("div",null,[l.value?(a(),m(o(z),{key:0,position:d.land.center},{default:f(()=>[l.value?(a(),m(o(O),{key:0},{default:f(()=>[M("div",K,q(d.land.id),1)]),_:1})):v("",!0)]),_:1},8,["position"])):v("",!0)]))}}),X=B({__name:"IslandClickHandler",props:{island:{type:Object,required:!0}},setup(d){const y=d,l=x("map"),n=x("layer");return C(()=>{n.on("click",()=>l.value.fitBounds(y.island.polygon))}),A(()=>{n.off("click")}),(p,u)=>null}}),Y={class:"about"},ee={key:0},te=["onClick"],oe={key:1},ne=B({__name:"AboutView",setup(d){const y=c([-17.7351,168.32461]),l=c(12),n=c([]),p=c(null),u=c([]),F=c([]),k=c({}),b=c(!1),$=t=>{console.log("sl",t),p.value=t},G=()=>{console.log("usl"),p.value=null},w=T(()=>p.value?n.value.find(t=>t.id===p.value):null),J=async t=>{const i=g.polygon([t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]).toGeoJSON(),e=await V.items("Land").readByQuery({limit:150,fields:["id","name","center","geometry","listings","listings.id","listings.amount"],filter:{center:{_intersects:i}}});n.value=e.data.map(s=>{let r=s.listings.length>0,U=s.geometry.coordinates[0].map(S=>new g.LatLng(S[1],S[0]));return{id:s.id,name:s.name,has_listings:r,starting_price:r?s.listings[0].amount:null,polygon:U,center:new g.LatLng(s.center.coordinates[1],s.center.coordinates[0])}})},N=async()=>{var i;const t=await V.items("Island").readByQuery({fields:["id","name","geometry","group.id","group.name"],limit:-1});u.value=(i=t.data)==null?void 0:i.map(e=>{const s=e.geometry.coordinates[0].map(r=>new g.LatLng(r[1],r[0]));return{...e,polygon:s}}),u.value.forEach(e=>{if(!e.group)return;let r=new g.GeoJSON(e.geometry).getBounds();k.value[e.group.id]||(k.value[e.group.id]=new g.LatLngBounds),k.value[e.group.id].extend(r)}),F.value=[...new Set(u.value.map(e=>e.group))]},Q=W.debounce(async t=>{console.log("update map");const i=t.getBounds();await J(i),u.value.length===0&&await N()},250),I=({zoom:t=void 0,map:i})=>{t&&(console.log("z",t),l.value=t),Q(i)};return C(async()=>{await N(),D(l,t=>b.value=t<10,{immediate:!0})}),(t,i)=>(a(),_("div",Y,[h(o(P),{center:y.value,zoom:15,class:"h-full w-full",onZoomend:I,onMove:I},{default:f(()=>[h(o(H)),b.value?v("",!0):(a(),_("div",ee,[o(w)?(a(),m(o(L),{key:0,positions:o(w).polygon,color:"red",weight:5,"fill-color":"red",onClick:G},null,8,["positions","weight"])):v("",!0),(a(!0),_(E,null,j(n.value,e=>(a(),m(o(L),{key:e.id,positions:e.polygon,color:"green",weight:2,"fill-color":"blue"},{default:f(()=>[h(o(O),{onClick:s=>$(e.id)},{default:f(()=>[M("div",{class:"text-blue-600 font-semibold",onClick:s=>$(e.id)},q(e.id),9,te)]),_:2},1032,["onClick"]),h(R,{land:e},null,8,["land"])]),_:2},1032,["positions","weight"]))),128)),o(w)?(a(),m(o(z),{key:1,position:o(w).center},null,8,["position"])):v("",!0)])),b.value?(a(),_("div",oe,[(a(!0),_(E,null,j(u.value,e=>(a(),m(o(L),{key:e.id,positions:e.polygon,color:"blue",weight:3,"fill-color":"light-blue"},{default:f(()=>[h(X,{island:e},null,8,["island"])]),_:2},1032,["positions","weight"]))),128))])):v("",!0)]),_:1},8,["center","zoom"])]))}});const le=Z(ne,[["__scopeId","data-v-1e068ac0"]]);export{le as default};
