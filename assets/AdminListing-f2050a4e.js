import{d as E,r as i,o as F,B as T,b as a,c as _,C as V,t as f,f as r,j as c,w as l,u as s,F as O,k as W,e as h}from"./index-4329d3ed.js";import{l as j,b as m,d as x,c as B,a as A,f as C,_ as M,e as D}from"./lodash-12e9fd16.js";const G={class:"admin-listing"},J={key:0},Q={key:1},R={class:"h-200 grid gap-4 max-w-2xl"},q=r("h1",null,"Listing Location",-1),H=r("h1",null,"Land Titles",-1),I=["onClick"],K=["onClick"],Y=E({__name:"AdminListing",setup(P){const p=i(18),u=i([-17.7351,168.32461]),v=i(!0),d=i(),y=i([]),g=i([]),L=e=>{console.log("sl",e),g.value.includes(e)||g.value.push(e)},$=e=>g.value.includes(e),b=j.debounce(async({center:e,map:t})=>{u.value=e,await z(t.getBounds())},500),N=async e=>{console.log("Fetching listing",e);try{const t=await x.items("Listing").readOne(e,{fields:["*","source.id","source.name","source.logo"]}),o=new m.LatLng(t.coordinates.coordinates[1],t.coordinates.coordinates[0]);return{...t,coordinates:o}}catch(t){console.error("api error",t)}},z=async e=>{const t=m.polygon([e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]).toGeoJSON(),o=await x.items("Land").readByQuery({limit:200,fields:["id","name","center","geometry","listings","listings.id","listings.amount"],filter:{center:{_intersects:t}}});y.value=o.data.map(n=>{let w=n.listings.length>0,S=n.geometry.coordinates[0].map(k=>new m.LatLng(k[1],k[0]));return{id:n.id,name:n.name,has_listings:w,starting_price:w?n.listings[0].amount:null,polygon:S,center:new m.LatLng(n.center.coordinates[1],n.center.coordinates[0])}})};return F(async()=>{const t=T().params.id;d.value=await N(t),v.value=!1,setTimeout(()=>{u.value=d.value.coordinates},1e3)}),(e,t)=>(a(),_("div",G,[v.value?(a(),_("div",J,"Loading")):(a(),_("div",Q,[V(f(d.value)+" ",1),r("div",R,[q,c(s(C),{center:u.value,zoom:p.value,class:"h-full w-full",onMove:s(b)},{default:l(()=>[c(s(B)),c(s(A),{position:d.value.coordinates},null,8,["position"])]),_:1},8,["center","zoom","onMove"]),H,c(s(C),{center:u.value,zoom:p.value,class:"h-full w-full",onMove:s(b)},{default:l(()=>[c(s(B)),(a(!0),_(O,null,W(y.value,o=>(a(),h(s(D),{key:o.id,positions:o.polygon,color:"blue","fill-color":"light-blue",weight:2},{default:l(()=>[$(o.id)?(a(),h(s(M),{key:0},{default:l(()=>[r("button",{class:"btn btn-sm btn-primary text-blue-600 font-semibold",onClick:n=>L(o.id)},f(o.id),9,I)]),_:2},1024)):(a(),h(s(M),{key:1},{default:l(()=>[r("button",{class:"btn btn-sm btn-default text-blue-600 font-semibold",onClick:n=>L(o.id)},f(o.id),9,K)]),_:2},1024))]),_:2},1032,["positions","weight"]))),128))]),_:1},8,["center","zoom","onMove"])])]))]))}});export{Y as default};
